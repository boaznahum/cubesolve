merge from abstract_reducer, some tests fail
make sure all queries use new context manager in operator that suspend animation and undo operation.