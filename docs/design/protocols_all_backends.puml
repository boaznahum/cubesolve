@startuml protocols_all_backends
!theme plain
skinparam classAttributeIconSize 0
hide members

title Protocols & All Backends - Class Diagram
footer Generated 2025-12-05

' ============================================
' PROTOCOLS (Interfaces) - TOP
' ============================================
package "protocols" as P <<Rectangle>> #E8F5E9 {
    interface Renderer
    interface ShapeRenderer
    interface DisplayListManager
    interface ViewStateManager
    interface EventLoop
    interface AppWindow
    interface AnimationBackend
    interface AnimatableViewer
    interface TextRenderer
    interface IWindow

    ' Abstract base classes (no-op defaults)
    abstract class AbstractRenderer
    abstract class AbstractShapeRenderer

    ' Base classes (real shared implementation)
    abstract class AppWindowBase

    ' Protocol relationships
    Renderer --> ShapeRenderer : shapes
    Renderer --> DisplayListManager : display_lists
    Renderer --> ViewStateManager : view

    AbstractRenderer ..|> Renderer
    AbstractShapeRenderer ..|> ShapeRenderer
    AppWindowBase ..|> AppWindow
}

' Force protocols package above backends
P -[hidden]down- pyglet
P -[hidden]down- pyglet2
P -[hidden]down- headless
P -[hidden]down- console
P -[hidden]down- tkinter

' ============================================
' PYGLET BACKEND (Legacy OpenGL)
' ============================================
package "backends/pyglet" as pyglet <<Rectangle>> #E3F2FD {
    class PygletRenderer
    class PygletShapeRenderer
    class PygletDisplayListManager
    class PygletViewStateManager
    class PygletEventLoop
    class PygletAppWindow
    class PygletWindow
    class PygletTextRenderer
    class PygletAnimation
}

' ============================================
' PYGLET2 BACKEND (Modern OpenGL)
' ============================================
package "backends/pyglet2" as pyglet2 <<Rectangle>> #FFF3E0 {
    class P2_PygletRenderer as "PygletRenderer"
    class P2_PygletEventLoop as "PygletEventLoop"
    class P2_PygletAppWindow as "PygletAppWindow"
    class P2_PygletWindow as "PygletWindow"
    class P2_PygletAnimation as "PygletAnimation"
    class ModernGLRenderer
    class ModernGLCubeViewer
    class ModernGLViewStateManager
    class ModernGLShapeAdapter
    class ModernGLRendererAdapter
}

' ============================================
' HEADLESS BACKEND (Testing)
' ============================================
package "backends/headless" as headless <<Rectangle>> #F3E5F5 {
    class HeadlessRenderer
    class HeadlessShapeRenderer
    class HeadlessDisplayListManager
    class HeadlessViewStateManager
    class HeadlessEventLoop
    class HeadlessAppWindow
    class HeadlessWindow
    class HeadlessTextRenderer
}

' ============================================
' CONSOLE BACKEND (Text-based)
' ============================================
package "backends/console" as console <<Rectangle>> #ECEFF1 {
    class ConsoleRenderer
    class ConsoleShapeRenderer
    class ConsoleDisplayListManager
    class ConsoleViewStateManager
    class ConsoleEventLoop
    class ConsoleAppWindow
}

' ============================================
' TKINTER BACKEND (2D Canvas)
' ============================================
package "backends/tkinter" as tkinter <<Rectangle>> #FBE9E7 {
    class TkinterRenderer
    class TkinterShapeRenderer
    class TkinterDisplayListManager
    class TkinterViewStateManager
    class TkinterEventLoop
    class TkinterAppWindow
    class TkinterWindow
    class TkinterTextRenderer
    class TkinterAnimation
}

' ============================================
' PROPER PROTOCOL IMPLEMENTATIONS
' ============================================

' Pyglet backend
PygletRenderer ..|> Renderer
PygletShapeRenderer ..|> ShapeRenderer
PygletDisplayListManager ..|> DisplayListManager
PygletViewStateManager ..|> ViewStateManager
PygletEventLoop ..|> EventLoop
PygletAnimation ..|> AnimationBackend
PygletTextRenderer ..|> TextRenderer
PygletAppWindow --|> AppWindowBase

' Pyglet2 backend
P2_PygletRenderer ..|> Renderer
P2_PygletEventLoop ..|> EventLoop
P2_PygletAnimation ..|> AnimationBackend
P2_PygletAppWindow --|> AppWindowBase
ModernGLCubeViewer ..|> AnimatableViewer
ModernGLViewStateManager ..|> ViewStateManager
ModernGLShapeAdapter ..|> AbstractShapeRenderer
ModernGLRendererAdapter ..|> AbstractRenderer

' Headless backend
HeadlessRenderer ..|> Renderer
HeadlessShapeRenderer ..|> ShapeRenderer
HeadlessDisplayListManager ..|> DisplayListManager
HeadlessViewStateManager ..|> ViewStateManager
HeadlessEventLoop ..|> EventLoop
HeadlessTextRenderer ..|> TextRenderer
HeadlessAppWindow --|> AppWindowBase

' Console backend
ConsoleRenderer ..|> Renderer
ConsoleShapeRenderer ..|> ShapeRenderer
ConsoleDisplayListManager ..|> DisplayListManager
ConsoleViewStateManager ..|> ViewStateManager
ConsoleEventLoop ..|> EventLoop
ConsoleAppWindow --|> AppWindowBase

' Tkinter backend
TkinterRenderer ..|> Renderer
TkinterShapeRenderer ..|> ShapeRenderer
TkinterDisplayListManager ..|> DisplayListManager
TkinterViewStateManager ..|> ViewStateManager
TkinterEventLoop ..|> EventLoop
TkinterAnimation ..|> AnimationBackend
TkinterTextRenderer ..|> TextRenderer
TkinterAppWindow --|> AppWindowBase

' ============================================
' DUCK TYPING - implements protocol but doesn't inherit (bold red)
' (metaclass conflict with pyglet.window.Window / tkinter.Tk)
' ============================================
PygletAppWindow .[#FF0000,bold,dashed].> AppWindow : <color:red>duck
PygletWindow .[#FF0000,bold,dashed].> IWindow : <color:red>duck
P2_PygletAppWindow .[#FF0000,bold,dashed].> AppWindow : <color:red>duck
P2_PygletWindow .[#FF0000,bold,dashed].> IWindow : <color:red>duck
TkinterWindow .[#FF0000,bold,dashed].> IWindow : <color:red>duck
HeadlessWindow .[#FF0000,bold,dashed].> IWindow : <color:red>duck

@enduml
